name: compile_go

trigger:
- none

resources:
  repositories:
  - repository: aoc
    type: github
    endpoint: martamazurkiewicz
    name: martamazurkiewicz/AdventOfCode
    ref: main

parameters:
- name: aoctask
  displayName: 'AoC task'
  type: string
  default: "2022-01" 

variables:
- name: aoctask
  value: ${{ parameters.aoctask }}

stages:
- stage:
  displayName: 'Build'
  pool:
    vmImage: 'ubuntu-latest'
  jobs: 
  - job: build
    steps:
    - checkout: aoc
    - task: Bash@3
      displayName: 'Check pipeline contents'
      inputs:
        targetType: 'inline'
        script: |
          ls -al $(System.DefaultWorkingDirectory)
          echo "===================="
          ls -al $(System.DefaultWorkingDirectory)/$(aoctask)
    - task: GoTool@0
      inputs:
        version: '1.17.4'
    - task: Go@0
      displayName: 'go get'
      inputs:
        arguments: '-d'
        workingDirectory: '/tmp'
    - task: Go@0
      inputs:
        command: 'build'
        workingDirectory: '$(System.DefaultWorkingDirectory)/$(aoctask)'
    - task: Bash@3
      displayName: 'Check pipeline contents'
      inputs:
        targetType: 'inline'
        script: |
          ls -al $(System.DefaultWorkingDirectory)/$(aoctask)'
    - task: Bash@3
      displayName: 'run task'
      inputs:
        targetType: 'inline'
        script: |
          #./main
