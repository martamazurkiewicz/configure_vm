name: compile_go

trigger:
- none

resources:
  repositories:
  - repository: aoc
    type: github
    endpoint: martamazurkiewicz
    name: martamazurkiewicz/AdventOfCode
    ref: main

parameters:
- name: aoctask
  displayName: 'AoC task'
  type: string
  default: "2022-01" 

variables:
- name: aoctask
  value: ${{ parameters.aoctask }}

stages:
- stage:
  displayName: 'Build'
  pool:
    vmImage: 'ubuntu-latest'
  jobs: 
  - job: build
    steps:
    - checkout: aoc
    - task: Bash@3
      displayName: 'Check pipeline contents'
      inputs:
        targetType: 'inline'
        script: |
          ls -al $(System.DefaultWorkingDirectory)
          echo "===================="
          ls -al $(System.DefaultWorkingDirectory)/$(aoctask)
    - task: GoTool@0
      inputs:
        version: '1.17.4'
    # - task: Go@0
    #   displayName: 'Go run'
    #   inputs:
    #     command: 'custom'
    #     customCommand:  'run $(aoctask)/main.go'
    - task: Go@0
      displayName: 'Go get'
      inputs:
        command: 'custom'
        customCommand:  'get -d $(aoctask)/main.go'
    - task: Go@0
      displayName: 'Go build'
      inputs:
        command: 'custom'
        customCommand:  'build $(aoctask)/main.go'
    - task: Bash@3
      displayName: 'Check pipeline contents'
      inputs:
        targetType: 'inline'
        script: |
          ls -al $(System.DefaultWorkingDirectory)/$(aoctask)'
    - task: Bash@3
      displayName: 'run task'
      inputs:
        targetType: 'inline'
        script: |
          #./$(aoctask)/main
